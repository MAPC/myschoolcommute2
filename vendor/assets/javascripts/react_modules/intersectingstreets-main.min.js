(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{305:function(e,t,n){e.exports=n(522)},520:function(e,t,n){},521:function(e,t,n){},522:function(e,t,n){"use strict";n.r(t);var a=n(1),o=n.n(a),i=n(83),s=n.n(i),l=n(38),r=n(39),c=n(44),u=n(40),d=n(45),m=n(531),h=n(535),p=n(534),v=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"map-container"},o.a.createElement("div",null,o.a.createElement("label",null,window.__("What is your approximate home location?")," ",o.a.createElement("span",{className:"required"},"(",window.__("required"),")"))),o.a.createElement("div",null,window.__("Please click the map at an intersection on your street, near your home:")),o.a.createElement(m.a,{center:this.props.center,zoom:this.props.zoom,onClick:this.props.addCustomPoint.bind(this)},o.a.createElement(h.a,{attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',url:"http://{s}.tile.osm.org/{z}/{x}/{y}.png"}),o.a.createElement(p.a,{position:this.props.school,className:"active-marker"}),this.props.points.map(function(t,n){var a=e.props.customPoint||n!==e.props.selectedIndex?.4:1;return o.a.createElement(p.a,{opacity:a,onClick:e.props.onMarkerClick.bind(e,n),position:[t.lat,t.lng],key:n})}),this.props.customPoint?o.a.createElement(p.a,{position:[this.props.customPoint.lat,this.props.customPoint.lng],key:1}):null))}}]),t}(a.Component),w=n(532),f=n(159),y=n.n(f),_=n(22),x=n.n(_),E="//mapc-admin.carto.com/api/v2/sql?q=",b=window.muni_id||1,g=window.school||{lat:42,lng:-71},S=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).IntersectingPoints=function(e){var t=e;return y.a.getJSON("".concat(E,"SELECT DISTINCT(st_name_2) AS text, lat, long AS lng FROM%20%22mapc-admin%22.survey_intersection%20WHERE st_name_1='").concat(t,"' AND town_id=").concat(b)).then(function(e){var t=e.rows.sort(function(e,t){return e.text>t.text?1:-1}),a=t.map(function(e){return[e.lat,e.lng]}),o=new x.a.LatLngBounds(a).getCenter();n.setState({points:t,lat:o.lat,lng:o.lng})})},n.OnDropdownChange=function(e,t){n.setState({selectedIntersectionIndex:0}),n.IntersectingStreets(t.value)},n.OnIntersectingPointsChange=function(e,t){var a=t.options.findIndex(function(e){return e.value===t.value});n.setState({selectedIntersectionIndex:a,customPoint:null},function(e){n.forceUpdate()})},n.OnMarkerClick=function(e){n.setState({selectedIntersectionIndex:e,customPoint:null})},n.AddCustomPoint=function(e){n.setState({customPoint:{lat:e.latlng.lat,lng:e.latlng.lng}})},n.ShowDropdowns=function(e){n.setState({showDropdowns:!0})},n.state={initialStreets:[{name:"",value:1}],intersectingStreets:[{name:"",value:1}],customPoint:null,selectedIntersection:null,selectedIntersectionIndex:0,points:[{lat:42,lng:-71}],lat:g.lat,lng:g.lng,school:g,zoom:16,showDropdowns:!1},n.query="",n}return Object(d.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){this.InitialStreets()}},{key:"InitialStreets",value:function(){var e=this;return y.a.getJSON("".concat(E,"SELECT DISTINCT(st_name_1) AS text%20, st_name_1 AS value FROM%20%22mapc-admin%22.survey_intersection%20WHERE town_id=").concat(b)).then(function(t){e.setState({initialStreets:t.rows})})}},{key:"IntersectingStreets",value:function(e){var t=this,n=e;return y.a.getJSON("".concat(E,"SELECT DISTINCT(st_name_2) AS text, st_name_2 AS value FROM%20%22mapc-admin%22.survey_intersection%20WHERE st_name_1='").concat(n,"' AND town_id=").concat(b)).then(function(n){var a=n.rows.sort(function(e,t){return e.text>t.text?1:-1});t.setState({intersectingStreets:a}),t.IntersectingPoints(e)})}},{key:"render",value:function(){var e=this.state.initialStreets,t=this.state.intersectingStreets,n=this.state.points[this.state.selectedIntersectionIndex],a=this.OnDropdownChange,i=this.OnIntersectingPointsChange,s=this.OnMarkerClick,l=this.state.customPoint||n;return o.a.createElement("div",{className:"ui equal width padded grid"},o.a.createElement("h1",null,"something"),o.a.createElement("div",{className:"row"},o.a.createElement(v,{zoom:this.state.zoom,points:this.state.points,school:this.state.school,center:[this.state.lat,this.state.lng],onMarkerClick:s,customPoint:this.state.customPoint,addCustomPoint:this.AddCustomPoint,selectedIndex:this.state.selectedIntersectionIndex})),o.a.createElement("div",{className:"row",onClick:this.ShowDropdowns,style:{display:this.state.showDropdowns?"none":"inherit"}},o.a.createElement("div",{className:"ui button"},window.__("...or tell us the street intersection closest to your home."))),o.a.createElement("div",{className:this.state.showDropdowns?"row active":"row",style:{display:this.state.showDropdowns?"flex":"none"}},o.a.createElement("div",{className:"column"},o.a.createElement("div",{className:"field"},o.a.createElement(w.a.Dropdown,{placeholder:"Select from an option below",fluid:!0,search:!0,selection:!0,options:e,label:window.__("Name of your street"),onChange:a}))),o.a.createElement("div",{className:"column"},o.a.createElement("div",{className:"field"},o.a.createElement(w.a.Dropdown,{placeholder:"Select from an option below",fluid:!0,search:!0,value:n.text,selection:!0,options:t,label:window.__("Name of nearest cross-street"),onChange:i}))),o.a.createElement("input",{type:"hidden",name:"survey_response[geometry]",value:"POINT (".concat(l.lng," ").concat(l.lat,")")})))}}]),t}(a.Component),O=[{value:"w",text:"Walk"},{value:"fv",text:"Family Vehicle (only children in your family)"},{value:"sb",text:"School Bus"},{value:"b",text:"Bicycle"},{value:"o",text:"Other (skateboard, scooter, inline skates, etc.)"},{value:"t",text:"Transit (city bus, subway, etc.)"},{value:"cp",text:"Carpool (with children from other families)"}].map(function(e){return{value:e.value,text:window.__(e.text)}}),k=[{value:"pk",text:"Pre-K"},{value:"k",text:"K"},{value:"1",text:"1"},{value:"2",text:"2"},{value:"3",text:"3"},{value:"4",text:"4"},{value:"5",text:"5"},{value:"6",text:"6"},{value:"7",text:"7"},{value:"8",text:"8"},{value:"9",text:"9"},{value:"10",text:"10"},{value:"11",text:"11"},{value:"12",text:"12"}],C=[{value:"y",text:"Yes"},{value:"n",text:"No"}].map(function(e){return{value:e.value,text:window.__(e.text)}}),I=function(e){e.id;var t=e.mode,n=e.question,a=e.name;return"fv"===t||"cp"===t?o.a.createElement("div",{className:"field"},o.a.createElement(w.a.Dropdown,{placeholder:n,fluid:!0,selection:!0,required:!0,name:a,label:window.__(n),options:C})):null},N=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).updateTo=function(e,t){n.setState({to:t.value})},n.updateFrom=function(e,t){n.setState({from:t.value})},n.state={to:"",from:"",id:e.id},n}return Object(d.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{className:"child-survey"},o.a.createElement("div",{className:"ui attached segment"},o.a.createElement("div",{className:"ui top attached label"},"Child ",this.state.id),o.a.createElement(w.a.Dropdown,{placeholder:"Select from an option below",fluid:!0,selection:!0,required:!0,label:window.__("What grade is your child in?"),options:k,labeled:!0,name:"survey_response[grade_".concat(this.state.id,"]")}),o.a.createElement(w.a.Dropdown,{placeholder:"Select from an option below",fluid:!0,selection:!0,required:!0,onChange:this.updateTo,options:O,label:window.__("How does your child get TO school on most days?"),name:"survey_response[to_school_".concat(this.state.id,"]")}),o.a.createElement(I,{id:this.state.id,mode:this.state.to,name:"survey_response[dropoff_".concat(this.state.id,"]"),question:"Do you usually drop off your child on your way to work or another destination?"}),o.a.createElement(w.a.Dropdown,{placeholder:"Select from an option below",fluid:!0,selection:!0,required:!0,onChange:this.updateFrom,options:O,label:window.__("How does your child get home FROM school on most days?"),name:"survey_response[from_school_".concat(this.state.id,"]")}),o.a.createElement(I,{id:this.state.id,mode:this.state.from,name:"survey_response[pickup_".concat(this.state.id,"]"),question:"Do you usually pick up your child on your way from work or another origin?"})))}}]),t}(a.Component),j=n(533),D=[{value:"0",text:"0"},{value:"1",text:"1"},{value:"2",text:"2"},{value:"3",text:"3"},{value:"4",text:"4"},{value:"5",text:"5"},{value:"6",text:"6"},{value:"7",text:"7"},{value:"8",text:"8"},{value:"9",text:"9"}],P=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).AddChild=function(){n.setState({count:n.state.count+1})},n.state={count:1},n}return Object(d.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){for(var e=[],t=0;t<this.state.count;t++)e.push(o.a.createElement("div",{key:t},o.a.createElement(N,{id:t+1})));return o.a.createElement("div",null,e,o.a.createElement(j.a,{onClick:this.AddChild,type:"button",className:"primary"},window.__("Add another child at this school")),o.a.createElement(w.a.Dropdown,{placeholder:"Select from an option below",fluid:!0,selection:!0,options:D,label:window.__("How many vehicles do you have in your household?"),name:"survey_response[nr_vehicles]"}),o.a.createElement(w.a.Dropdown,{placeholder:"Select from an option below",fluid:!0,selection:!0,options:D,label:window.__("How many people in your household have a driver's license?"),name:"survey_response[nr_licenses]"}))}}]),t}(a.Component),A=(n(520),function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{className:"App"},o.a.createElement(S,null),o.a.createElement(P,null))}}]),t}(a.Component));n(521);s.a.render(o.a.createElement(A,null),document.getElementById("root"))}},[[305,1,2]]]);
//# sourceMappingURL=main.bbc1f03d.chunk.js.map