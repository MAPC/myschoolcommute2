(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{306:function(e,t,n){e.exports=n(523)},521:function(e,t,n){},522:function(e,t,n){},523:function(e,t,n){"use strict";n.r(t);var a=n(1),o=n.n(a),s=n(83),i=n.n(s),r=n(38),l=n(39),c=n(44),u=n(40),d=n(45),h=n(295),m=n(532),p=n(536),v=n(535),f=function(e){function t(){return Object(r.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"map-container"},o.a.createElement("div",null,o.a.createElement("label",null,window.__("What is your approximate home location?")," ",o.a.createElement("span",{className:"required"},"(",window.__("required"),")"))),o.a.createElement("div",null,window.__("Please click the map at an intersection on your street, near your home:")),o.a.createElement(m.a,{center:this.props.center,zoom:this.props.zoom,onClick:this.props.addCustomPoint.bind(this)},o.a.createElement(p.a,{attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',url:"http://{s}.tile.osm.org/{z}/{x}/{y}.png"}),o.a.createElement(v.a,{position:this.props.school,className:"active-marker"}),this.props.points.map(function(t,n){var a=e.props.customPoint||n!==e.props.selectedIndex?.4:1;return o.a.createElement(v.a,{opacity:a,onClick:e.props.onMarkerClick.bind(e,n),position:[t.lat,t.lng],key:n})}),this.props.customPoint?o.a.createElement(v.a,{position:[this.props.customPoint.lat,this.props.customPoint.lng],key:1}):null))}}]),t}(a.Component),w=n(533),_=n(114),y=n.n(_),E=n(22),g=n.n(E),S="//mapc-admin.carto.com/api/v2/sql?q=",b=window.muni_id||1,x=window.school||{lat:42,lng:-71},O=[],C={munis:O,muni:b,initialStreets:[{name:"",value:1}],intersectingStreets:[{name:"",value:1}],customPoint:null,selectedIntersection:null,selectedIntersectionIndex:0,points:[{lat:42,lng:-71}],lat:x.lat,lng:x.lng,school:x,zoom:16,showDropdowns:!1},k=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).IntersectingPoints=function(e){var t=e;return y.a.getJSON("".concat(S,"SELECT DISTINCT(st_name_2) AS text, lat, long AS lng FROM%20%22mapc-admin%22.survey_intersection%20WHERE st_name_1='").concat(t,"' AND town_id=").concat(n.state.muni)).then(function(e){var t=e.rows.sort(function(e,t){return e.text>t.text?1:-1}),a=t.map(function(e){return[e.lat,e.lng]}),o=new g.a.LatLngBounds(a).getCenter();n.setState({points:t,lat:o.lat,lng:o.lng})})},n.OnMuniChange=function(e,t){var a=t.value;n.setState(Object(h.a)({},C,{muni:a,munis:O,showDropdowns:!0})),n.InitialStreets(a)},n.OnDropdownChange=function(e,t){n.setState({selectedIntersectionIndex:0}),n.IntersectingStreets(t.value)},n.OnIntersectingPointsChange=function(e,t){var a=t.options.findIndex(function(e){return e.value===t.value});n.setState({selectedIntersectionIndex:a,customPoint:null},function(e){n.forceUpdate()})},n.OnMarkerClick=function(e){n.setState({selectedIntersectionIndex:e,customPoint:null})},n.AddCustomPoint=function(e){n.setState({customPoint:{lat:e.latlng.lat,lng:e.latlng.lng}})},n.ShowDropdowns=function(e){n.setState({showDropdowns:!0})},n.state=C,n.query="",n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.Munis(),this.InitialStreets(this.state.muni)}},{key:"Munis",value:function(){var e=this;return O.length>0?this.setState({munis:O}):y.a.getJSON("".concat(S,"SELECT DISTINCT(town) as text, town_id as value FROM %22mapc-admin%22.survey_intersection ORDER BY town")).then(function(t){O=t.rows,e.setState({munis:O})})}},{key:"InitialStreets",value:function(e){var t=this;return y.a.getJSON("".concat(S,"SELECT DISTINCT(st_name_1) AS text%20, st_name_1 AS value FROM%20%22mapc-admin%22.survey_intersection%20WHERE town_id=").concat(e," ORDER BY st_name_1")).then(function(e){t.setState({initialStreets:e.rows})})}},{key:"IntersectingStreets",value:function(e){var t=this,n=e;return y.a.getJSON("".concat(S,"SELECT DISTINCT(st_name_2) AS text, st_name_2 AS value FROM%20%22mapc-admin%22.survey_intersection%20WHERE st_name_1='").concat(n,"' AND town_id=").concat(this.state.muni," ORDER BY st_name_2")).then(function(n){var a=n.rows.sort(function(e,t){return e.text>t.text?1:-1});t.setState({intersectingStreets:a}),t.IntersectingPoints(e)})}},{key:"render",value:function(){var e=this.state.initialStreets,t=this.state.intersectingStreets,n=this.state.points[this.state.selectedIntersectionIndex],a=this.state.munis,s=this.state.muni,i=this.OnMuniChange,r=this.OnDropdownChange,l=this.OnIntersectingPointsChange,c=this.OnMarkerClick,u=this.state.customPoint||n;return o.a.createElement("div",{className:"ui equal width padded grid"},o.a.createElement("div",{className:"row"},o.a.createElement(f,{zoom:this.state.zoom,points:this.state.points,school:this.state.school,center:[this.state.lat,this.state.lng],onMarkerClick:c,customPoint:this.state.customPoint,addCustomPoint:this.AddCustomPoint,selectedIndex:this.state.selectedIntersectionIndex})),o.a.createElement("div",{className:"row",onClick:this.ShowDropdowns,style:{display:this.state.showDropdowns?"none":"inherit"}},o.a.createElement("div",{className:"ui button"},window.__("...or tell us the street intersection closest to your home."))),o.a.createElement("div",{className:this.state.showDropdowns?"row active":"row",style:{display:this.state.showDropdowns?"flex":"none"}},o.a.createElement("div",{className:"column"},o.a.createElement("div",{className:"field"},o.a.createElement(w.a.Dropdown,{placeholder:"Select from an option below",fluid:!0,search:!0,selection:!0,options:a,value:s,label:window.__("Name of your town/city"),onChange:i}))),o.a.createElement("div",{className:"column"},o.a.createElement("div",{className:"field"},o.a.createElement(w.a.Dropdown,{placeholder:"Select from an option below",fluid:!0,search:!0,selection:!0,options:e,label:window.__("Name of your street"),onChange:r}))),o.a.createElement("div",{className:"column"},o.a.createElement("div",{className:"field"},o.a.createElement(w.a.Dropdown,{placeholder:"Select from an option below",fluid:!0,search:!0,value:n.text,selection:!0,options:t,label:window.__("Name of nearest cross-street (intersection)"),onChange:l}))),o.a.createElement("input",{type:"hidden",name:"survey_response[geometry]",value:"POINT (".concat(u.lng," ").concat(u.lat,")")})))}}]),t}(a.Component),N=[{value:"w",text:"Walk"},{value:"fv",text:"Family Vehicle (only children in your family)"},{value:"sb",text:"School Bus (regular & SPED transport)"},{value:"b",text:"Bike (skateboard, scooter, inline skates, etc.)"},{value:"o",text:"Other (private bus/van, taxi, after-school transport, etc.)"},{value:"t",text:"Transit (city bus, subway, etc.)"},{value:"cp",text:"Carpool (with children from other families)"}].map(function(e){return{value:e.value,text:window.__(e.text)}}),I=[{value:"pk",text:"Pre-K"},{value:"k",text:"K"},{value:"1",text:"1"},{value:"2",text:"2"},{value:"3",text:"3"},{value:"4",text:"4"},{value:"5",text:"5"},{value:"6",text:"6"},{value:"7",text:"7"},{value:"8",text:"8"},{value:"9",text:"9"},{value:"10",text:"10"},{value:"11",text:"11"},{value:"12",text:"12"}],D=[{value:"y",text:"Yes"},{value:"n",text:"No"}].map(function(e){return{value:e.value,text:window.__(e.text)}}),j=function(e){e.id;var t=e.mode,n=e.question,a=e.name,s=e.onChange;return"fv"===t||"cp"===t?o.a.createElement("div",{className:"field"},o.a.createElement(w.a.Dropdown,{placeholder:n,fluid:!0,selection:!0,required:!0,name:a,onChange:s,label:window.__(n),options:D})):null},P=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).updateTo=function(e,t){n.setState({to:t.value})},n.updateFrom=function(e,t){n.setState({from:t.value})},n.updateGrade=function(e,t){var a=t.value;n.setState({grade:a})},n.updateDropoff=function(e,t){var a=t.value;n.setState({dropoff:a})},n.updatePickup=function(e,t){var a=t.value;n.setState({pickup:a})},n.state={to:"",from:"",id:e.id,grade:"",dropoff:"",pickup:""},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{className:"child-survey"},o.a.createElement("div",{className:"ui attached segment"},o.a.createElement("div",{className:"ui top attached label"},"Child ",this.state.id),o.a.createElement(w.a.Dropdown,{placeholder:"Select from an option below",fluid:!0,selection:!0,required:!0,label:window.__("What grade is your child in?"),options:I,labeled:!0,onChange:this.updateGrade,name:"survey_response[grade_".concat(this.state.id,"]")}),o.a.createElement("input",{type:"hidden",name:"survey_response[grade_".concat(this.state.id,"]"),value:this.state.grade}),o.a.createElement(w.a.Dropdown,{placeholder:"Select from an option below",fluid:!0,selection:!0,required:!0,onChange:this.updateTo,options:N,label:window.__("How does your child get TO school on most days?"),name:"survey_response[to_school_".concat(this.state.id,"]")}),o.a.createElement("input",{type:"hidden",name:"survey_response[to_school_".concat(this.state.id,"]"),value:this.state.to}),o.a.createElement(j,{id:this.state.id,mode:this.state.to,onChange:this.updateDropoff,name:"survey_response[dropoff_".concat(this.state.id,"]"),question:"Do you usually drop off your child on your way to work or another destination (other than home)?"}),o.a.createElement("input",{type:"hidden",name:"survey_response[dropoff_".concat(this.state.id,"]"),value:this.state.dropoff}),o.a.createElement(w.a.Dropdown,{placeholder:"Select from an option below",fluid:!0,selection:!0,required:!0,onChange:this.updateFrom,options:N,label:window.__("How does your child get home FROM school on most days?"),name:"survey_response[from_school_".concat(this.state.id,"]")}),o.a.createElement("input",{type:"hidden",name:"survey_response[from_school_".concat(this.state.id,"]"),value:this.state.from}),o.a.createElement(j,{id:this.state.id,mode:this.state.from,onChange:this.updatePickup,name:"survey_response[pickup_".concat(this.state.id,"]"),question:"Do you usually pick up your child on your way from work or another location (other than home)?"}),o.a.createElement("input",{type:"hidden",name:"survey_response[pickup_".concat(this.state.id,"]"),value:this.state.pickup})))}}]),t}(a.Component),T=n(534),M=[{value:"0",text:"0"},{value:"1",text:"1"},{value:"2",text:"2"},{value:"3",text:"3"},{value:"4",text:"4"},{value:"5",text:"5"},{value:"6",text:"6"},{value:"7",text:"7"},{value:"8",text:"8"},{value:"9",text:"9"}],A=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).AddChild=function(){n.setState({count:n.state.count+1})},n.updateNrVehicles=function(e,t){var a=t.value;n.setState({nrVehicles:a})},n.updateNrLicenses=function(e,t){var a=t.value;n.setState({nrLicenses:a})},n.state={count:1,nrVehicles:"",nrLicenses:""},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){for(var e=[],t=0;t<this.state.count;t++)e.push(o.a.createElement("div",{key:t},o.a.createElement(P,{id:t+1})));return o.a.createElement("div",null,e,o.a.createElement(T.a,{onClick:this.AddChild,type:"button",className:"primary"},window.__("Add another child at this school")),o.a.createElement(w.a.Dropdown,{placeholder:"Select from an option below",fluid:!0,selection:!0,options:M,onChange:this.updateNrVehicles,label:window.__("How many vehicles do you have in your household?"),name:"survey_response[nr_vehicles]"}),o.a.createElement("input",{type:"hidden",name:"survey_response[nr_vehicles]",value:this.state.nrVehicles}),o.a.createElement(w.a.Dropdown,{placeholder:"Select from an option below",fluid:!0,selection:!0,options:M,onChange:this.updateNrLicenses,label:window.__("How many people in your household have a driver's license?"),name:"survey_response[nr_licenses]"}),o.a.createElement("input",{type:"hidden",name:"survey_response[nr_licenses]",value:this.state.nrLicenses}))}}]),t}(a.Component),R=(n(521),function(e){function t(){return Object(r.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{className:"App"},o.a.createElement(k,null),o.a.createElement(A,null))}}]),t}(a.Component));n(522);i.a.render(o.a.createElement(R,null),document.getElementById("root"))}},[[306,1,2]]]);
//# sourceMappingURL=main.3d43f987.chunk.js.map